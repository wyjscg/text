impl UndirectedGraph {
    pub fn remove_node(&mut self, n: &dyn Node) {
        if !self.nodes.contains_key(&n.id()) {
            return;
        }
        self.nodes.remove(&n.id());

        let node_id = n.id();
        if let Some(edge_holder) = self.edges.remove(&node_id) {
            let mut neighbors_to_update: Vec<i64> = Vec::new();
            edge_holder.visit(|neighbor, _edge| {
                neighbors_to_update.push(neighbor);
            });

            for neighbor in neighbors_to_update {
                if let Some(neighbor_edges) = self.edges.remove(&neighbor) {
                    self.edges.insert(neighbor, neighbor_edges.delete(node_id));
                }
            }
        }

        self.free_ids.insert(node_id);
        self.used_ids.remove(&node_id);
    }
}
